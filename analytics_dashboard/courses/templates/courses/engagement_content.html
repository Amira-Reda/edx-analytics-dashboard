{% extends "courses/base-course.html" %}

{% load i18n %}
{% load staticfiles %}
{% load waffle_tags %}
{% load dashboard_extras %}

{% comment %}
Individual course-centric engagement content view.
{% endcomment %}

{% block view-name %}view-course-engagement view-dashboard{% endblock view-name %}

{% block javascript %}
  {{ block.super }}
  <script src="{% static 'js/engagement-content-main.js' %}"></script>
{% endblock javascript %}

{% block content %}
  <section class="view-section">
    <div class="section-heading">
      <h4 class="section-title">{% trans "Weekly Student Engagement" %}</h4>
      <span class="section-heading-note small">{% trans "How many students are interacting with my course?" %}</span>
    </div>

    <div class="section-content section-data-graph">
      <div class="section-content section-data-viz">
        <div id="engagement-trend-view">
          <div class="line-chart-container">
            <div class="line-chart ">
              {% comment %}Translators: "Trend" is a graph of weekly student activity. Please translate accordingly.{% endcomment %}
              {% trans "Loading Trend..." as loading_msg %}
              {% include "loading.html" with message=loading_msg %}
            </div>
          </div>
        </div>
        <span class="small" data-role="activity-week">
          {% captureas date %}{{ summary.week_of_activity|date }}{% endcaptureas %}
          {% blocktrans %}Activity through the week ending {{ date }}.{% endblocktrans %}
        </span>
      </div>
    </div>
  </section>
  <section class="view-section">
    <div class="section-heading bordered">
      <h4 class="section-title">{% trans "Student Activity Metrics" %}</h4>
    </div>

    <div class="row">
      <div class="col-xs-12 col-sm-3" data-activity-type="any">
        {% summary_point summary.any "Active Students" "last week" tooltips.all_activity_summary %}
      </div>

      <div class="col-xs-12 col-sm-3" data-activity-type="played_video">
        {% summary_point summary.played_video "Watched a Video" "last week" tooltips.played_video_summary %}
      </div>

      <div class="col-xs-12 col-sm-3" data-activity-type="attempted_problem">
        {% summary_point summary.attempted_problem "Tried a Problem" "last week" tooltips.attempted_problem_summary %}
      </div>

      {% switch show_engagement_forum_activity %}
        <div class="col-xs-12 col-sm-3" data-activity-type="posted_forum">
          {% summary_point summary.posted_forum "Posted in Forum" "last week" tooltips.posted_forum_summary %}
        </div>
      {% endswitch %}
    </div>
  </section>
  <section class="view-section">
  <div class="section-heading">
    <h4 class="section-title">{% trans "Content Engagement Breakdown" %}</h4>

    <div class="section-actions">
      <a href="{% url 'courses:csv_engagement_activity_trend' course_id=course_id %}" class="btn btn-default"
         data-role="engagement-trend-csv" data-track-type="click"
         data-track-event="edx.bi.csv.downloaded" data-track-category="trend">
        <i class="ico fa fa-download"></i> {% trans "Download CSV" %}
      </a>
    </div>
  </div>

  <div class="section-content section-data-table" data-role="engagement-table">
    {% trans "Loading Table..." as loading_msg %}
    {% include "loading.html" with message=loading_msg %}
  </div>
  </section>
{% endblock content %}
